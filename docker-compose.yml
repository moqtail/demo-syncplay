services:
  relay:
    build:
      context: .
      dockerfile: Dockerfile.relay
    ports:
      - "4448:4433/udp"
    restart: always
    volumes:
      - ./cert:/etc/relay/cert:ro

  publisher:
    depends_on:
      - relay
    build:
      context: apps/publisher
    restart: always
    volumes:
      - ./source.mp4:/usr/src/app/source.mp4
    environment:
      RELAY_URL: "https://relay:4433"

  server:
    build:
      context: apps/server
    ports:
      - "15001:8080"
    restart: always

  client:
    depends_on:
      - server
      - relay
    build:
      context: apps/client
    ports:
      - "15173:4173"
    restart: always
